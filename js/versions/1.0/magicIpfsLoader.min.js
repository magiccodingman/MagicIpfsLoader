!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.untar=t()}(this,function(){"use strict";function e(e){function t(e){for(var t=0,o=r.length;t<o;++t)r[t](e);n.push(e)}if("function"!=typeof Promise)throw Error("Promise implementation not available in this environment.");var r=[],n=[],o=new Promise(function(r,n){e(r,n,t)});o.progress=function(e){if("function"!=typeof e)throw Error("cb is not a function.");for(var t=0,i=n.length;t<i;++t)e(n[t]);return r.push(e),o};var i=o.then;return o.then=function(e,t,r){return i.call(o,e,t),void 0!==r&&o.progress(r),o},o}var t,r=window||this,n=r.URL||r.webkitURL,o={blob:{get:function(){return this._blob||(this._blob=new Blob([this.buffer]))}},getBlobUrl:{value:function(){return this._blobUrl||(this._blobUrl=n.createObjectURL(this.blob))}},readAsString:{value:function(){for(var e=this.buffer,t=e.byteLength,r=new DataView(e),n=[],o=0;o<t;++o){var i=r.getUint8(1*o,!0);n.push(i)}return this._string=String.fromCharCode.apply(null,n)}},readAsJSON:{value:function(){return JSON.parse(this.readAsString())}}};return t=(window||this).URL.createObjectURL(new Blob(['"use strict";function UntarWorker(){}function decodeUTF8(e){for(var r="",t=0;t<e.length;){var a=e[t++];if(a>127){if(a>191&&a<224){if(t>=e.length)throw"UTF-8 decode: incomplete 2-byte sequence";a=(31&a)<<6|63&e[t]}else if(a>223&&a<240){if(t+1>=e.length)throw"UTF-8 decode: incomplete 3-byte sequence";a=(15&a)<<12|(63&e[t])<<6|63&e[++t]}else{if(!(a>239&&a<248))throw"UTF-8 decode: unknown multibyte start 0x"+a.toString(16)+" at index "+(t-1);if(t+2>=e.length)throw"UTF-8 decode: incomplete 4-byte sequence";a=(7&a)<<18|(63&e[t])<<12|(63&e[++t])<<6|63&e[++t]}++t}if(a<=65535)r+=String.fromCharCode(a);else{if(!(a<=1114111))throw"UTF-8 decode: code point 0x"+a.toString(16)+" exceeds UTF-16 reach";a-=65536,r+=String.fromCharCode(a>>10|55296),r+=String.fromCharCode(1023&a|56320)}}return r}function PaxHeader(e){this._fields=e}function TarFile(){}function UntarStream(e){this._bufferView=new DataView(e),this._position=0}function UntarFileStream(e){this._stream=new UntarStream(e),this._globalPaxHeader=null}if(UntarWorker.prototype={onmessage:function(e){try{if("extract"!==e.data.type)throw new Error("Unknown message type: "+e.data.type);this.untarBuffer(e.data.buffer)}catch(r){this.postError(r)}},postError:function(e){this.postMessage({type:"error",data:{message:e.message}})},postLog:function(e,r){this.postMessage({type:"log",data:{level:e,msg:r}})},untarBuffer:function(e){try{for(var r=new UntarFileStream(e);r.hasNext();){var t=r.next();this.postMessage({type:"extract",data:t},[t.buffer])}this.postMessage({type:"complete"})}catch(a){this.postError(a)}},postMessage:function(e,r){self.postMessage(e,r)}},"undefined"!=typeof self){var worker=new UntarWorker;self.onmessage=function(e){worker.onmessage(e)}}PaxHeader.parse=function(e){for(var r=new Uint8Array(e),t=[];r.length>0;){var a=parseInt(decodeUTF8(r.subarray(0,r.indexOf(32)))),n=decodeUTF8(r.subarray(0,a)),i=n.match(/^\\d+ ([^=]+)=(.*)\\n$/);if(null===i)throw new Error("Invalid PAX header data format.");var s=i[1],o=i[2];0===o.length?o=null:null!==o.match(/^\\d+$/)&&(o=parseInt(o));var f={name:s,value:o};t.push(f),r=r.subarray(a)}return new PaxHeader(t)},PaxHeader.prototype={applyHeader:function(e){this._fields.forEach(function(r){var t=r.name,a=r.value;"path"===t?(t="name",void 0!==e.prefix&&delete e.prefix):"linkpath"===t&&(t="linkname"),null===a?delete e[t]:e[t]=a})}},UntarStream.prototype={readString:function(e){for(var r=1,t=e*r,a=[],n=0;n<e;++n){var i=this._bufferView.getUint8(this.position()+n*r,!0);if(0===i)break;a.push(i)}return this.seek(t),String.fromCharCode.apply(null,a)},readBuffer:function(e){var r;if("function"==typeof ArrayBuffer.prototype.slice)r=this._bufferView.buffer.slice(this.position(),this.position()+e);else{r=new ArrayBuffer(e);var t=new Uint8Array(r),a=new Uint8Array(this._bufferView.buffer,this.position(),e);t.set(a)}return this.seek(e),r},seek:function(e){this._position+=e},peekUint32:function(){return this._bufferView.getUint32(this.position(),!0)},position:function(e){return void 0===e?this._position:void(this._position=e)},size:function(){return this._bufferView.byteLength}},UntarFileStream.prototype={hasNext:function(){return this._stream.position()+4<this._stream.size()&&0!==this._stream.peekUint32()},next:function(){return this._readNextFile()},_readNextFile:function(){var e=this._stream,r=new TarFile,t=!1,a=null,n=e.position(),i=n+512;switch(r.name=e.readString(100),r.mode=e.readString(8),r.uid=parseInt(e.readString(8)),r.gid=parseInt(e.readString(8)),r.size=parseInt(e.readString(12),8),r.mtime=parseInt(e.readString(12),8),r.checksum=parseInt(e.readString(8)),r.type=e.readString(1),r.linkname=e.readString(100),r.ustarFormat=e.readString(6),r.ustarFormat.indexOf("ustar")>-1&&(r.version=e.readString(2),r.uname=e.readString(32),r.gname=e.readString(32),r.devmajor=parseInt(e.readString(8)),r.devminor=parseInt(e.readString(8)),r.namePrefix=e.readString(155),r.namePrefix.length>0&&(r.name=r.namePrefix+"/"+r.name)),e.position(i),r.type){case"0":case"":r.buffer=e.readBuffer(r.size);break;case"1":break;case"2":break;case"3":break;case"4":break;case"5":break;case"6":break;case"7":break;case"g":t=!0,this._globalPaxHeader=PaxHeader.parse(e.readBuffer(r.size));break;case"x":t=!0,a=PaxHeader.parse(e.readBuffer(r.size))}void 0===r.buffer&&(r.buffer=new ArrayBuffer(0));var s=i+r.size;return r.size%512!==0&&(s+=512-r.size%512),e.position(s),t&&(r=this._readNextFile()),null!==this._globalPaxHeader&&this._globalPaxHeader.applyHeader(r),null!==a&&a.applyHeader(r),r}};'])),function n(i){if(!(i instanceof ArrayBuffer))throw TypeError("arrayBuffer is not an instance of ArrayBuffer.");if(!r.Worker)throw Error("Worker implementation is not available in this environment.");return new e(function(e,r,n){var a=new Worker(t),s=[];a.onerror=function(e){r(e)},a.onmessage=function(t){switch((t=t.data).type){case"log":console[t.data.level]("Worker: "+t.data.msg);break;case"extract":var i,l=(i=t.data,Object.defineProperties(i,o),i);s.push(l),n(l);break;case"complete":a.terminate(),e(s);break;case"error":a.terminate(),r(Error(t.data.message));break;default:a.terminate(),r(Error("Unknown message from worker: "+t.type))}},a.postMessage({type:"extract",buffer:i},[i])})}}),function(e,t){"object"==typeof module&&module.exports?module.exports=t():e.Multiformats=t()}("undefined"!=typeof self?self:this,function(){return(()=>{var e=Object.defineProperty,t=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,o=(t,r)=>{for(var n in r)e(t,n,{get:r[n],enumerable:!0})},i={};o(i,{CID:()=>z,bytes:()=>a,digest:()=>_,hasher:()=>N,varint:()=>k});var a={};o(a,{coerce:()=>u,empty:()=>s,equals:()=>f,fromHex:()=>c,fromString:()=>h,isBinary:()=>d,toHex:()=>l,toString:()=>p});var s=new Uint8Array(0);function l(e){return e.reduce((e,t)=>e+t.toString(16).padStart(2,"0"),"")}function c(e){let t=e.match(/../g);return null!=t?new Uint8Array(t.map(e=>parseInt(e,16))):s}function f(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function u(e){if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw Error("Unknown type, must be binary type")}function d(e){return e instanceof ArrayBuffer||ArrayBuffer.isView(e)}function h(e){return new TextEncoder().encode(e)}function p(e){return new TextDecoder().decode(e)}var g=function e(t,r){if(t.length>=255)throw TypeError("Alphabet too long");for(var n=new Uint8Array(256),o=0;o<n.length;o++)n[o]=255;for(var i=0;i<t.length;i++){var a=t.charAt(i),s=a.charCodeAt(0);if(255!==n[s])throw TypeError(a+" is ambiguous");n[s]=i}var l=t.length,c=t.charAt(0),f=Math.log(l)/Math.log(256),u=Math.log(256)/Math.log(l);function d(e){if("string"!=typeof e)throw TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var r=0,o=0;e[t]===c;)r++,t++;for(var i=(e.length-t)*f+1>>>0,a=new Uint8Array(i);e[t];){var s=n[e.charCodeAt(t)];if(255===s)return;for(var u=0,d=i-1;(0!==s||u<o)&&-1!==d;d--,u++)s+=l*a[d]>>>0,a[d]=s%256>>>0,s=s/256>>>0;if(0!==s)throw Error("Non-zero carry");o=u,t++}if(" "!==e[t]){for(var h=i-o;h!==i&&0===a[h];)h++;for(var p=new Uint8Array(r+(i-h)),g=r;h!==i;)p[g++]=a[h++];return p}}}return{encode:function e(r){if(r instanceof Uint8Array||(ArrayBuffer.isView(r)?r=new Uint8Array(r.buffer,r.byteOffset,r.byteLength):Array.isArray(r)&&(r=Uint8Array.from(r))),!(r instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===r.length)return"";for(var n=0,o=0,i=0,a=r.length;i!==a&&0===r[i];)i++,n++;for(var s=(a-i)*u+1>>>0,f=new Uint8Array(s);i!==a;){for(var d=r[i],h=0,p=s-1;(0!==d||h<o)&&-1!==p;p--,h++)d+=256*f[p]>>>0,f[p]=d%l>>>0,d=d/l>>>0;if(0!==d)throw Error("Non-zero carry");o=h,i++}for(var g=s-o;g!==s&&0===f[g];)g++;for(var m=c.repeat(n);g<s;++g)m+=t.charAt(f[g]);return m},decodeUnsafe:d,decode:function e(t){var n=d(t);if(n)return n;throw Error(`Non-${r} character`)}}},m=class{decoders;constructor(e){this.decoders=e}or(e){return y(this,e)}decode(e){let t=e[0],r=this.decoders[t];if(null!=r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function y(e,t){return new m({...e.decoders??{[e.prefix]:e},...t.decoders??{[t.prefix]:t}})}var b=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new class{name;prefix;baseEncode;constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}(e,t,r),this.decoder=new class{name;prefix;baseDecode;prefixCodePoint;constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return y(this,e)}}(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function v({name:e,prefix:t,encode:r,decode:n}){return new b(e,t,r,n)}function $({name:e,prefix:t,alphabet:r}){let{encode:n,decode:o}=g(r,e);return v({prefix:t,name:e,encode:n,decode:e=>u(o(e))})}function w({name:e,prefix:t,bitsPerChar:r,alphabet:n}){return v({prefix:t,name:e,encode:e=>(function e(t,r,n){let o="="===r[r.length-1],i=(1<<n)-1,a="",s=0,l=0;for(let c=0;c<t.length;++c)for(l=l<<8|t[c],s+=8;s>n;)s-=n,a+=r[i&l>>s];if(0!==s&&(a+=r[i&l<<n-s]),o)for(;a.length*n&7;)a+="=";return a})(e,n,r),decode:t=>(function e(t,r,n,o){let i={};for(let a=0;a<r.length;++a)i[r[a]]=a;let s=t.length;for(;"="===t[s-1];)--s;let l=new Uint8Array(s*n/8|0),c=0,f=0,u=0;for(let d=0;d<s;++d){let h=i[t[d]];if(void 0===h)throw SyntaxError(`Non-${o} character`);f=f<<n|h,(c+=n)>=8&&(c-=8,l[u++]=255&f>>c)}if(c>=n||255&f<<8-c)throw SyntaxError("Unexpected end of data");return l})(t,n,r,e)})}var x=w({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});w({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),w({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),w({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),w({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),w({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),w({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),w({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),w({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var S=$({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});$({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var _={};o(_,{Digest:()=>P,create:()=>L,decode:()=>E,equals:()=>B});var k={};o(k,{decode:()=>A,encodeTo:()=>W,encodingLength:()=>D});function C(e,t,r){t=t||[],r=r||0;for(var n=r;e>=2147483648;)t[r++]=255&e|128,e/=128;for(;-128&e;)t[r++]=255&e|128,e>>>=7;return t[r]=0|e,C.bytes=r-n+1,t}function U(e,t){var r,n=0,t=t||0,o=0,i=t,a=e.length;do{if(i>=a)throw U.bytes=0,RangeError("Could not decode varint");r=e[i++],n+=o<28?(127&r)<<o:(127&r)*Math.pow(2,o),o+=7}while(r>=128);return U.bytes=i-t,n}var I={encode:C,decode:U,encodingLength:function(e){return e<128?1:e<16384?2:e<2097152?3:e<268435456?4:e<34359738368?5:e<4398046511104?6:e<562949953421312?7:e<72057594037927940?8:e<0x7fffffffffffffff?9:10}};function A(e,t=0){return[I.decode(e,t),I.decode.bytes]}function W(e,t,r=0){return I.encode(e,t,r),t}function D(e){return I.encodingLength(e)}function L(e,t){let r=t.byteLength,n=D(e),o=n+D(r),i=new Uint8Array(o+r);return W(e,i,0),W(r,i,n),i.set(t,o),new P(e,r,t,i)}function E(e){let t=u(e),[r,n]=A(t),[o,i]=A(t.subarray(n)),a=t.subarray(n+i);if(a.byteLength!==o)throw Error("Incorrect length");return new P(r,o,a,t)}function B(e,t){if(e===t)return!0;{let r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&f(e.bytes,r.bytes)}}var P=class{code;size;digest;bytes;constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}};function F(e,t){let{bytes:r,version:n}=e;return 0===n?function e(t,r,n){let{prefix:o}=n;if(o!==S.prefix)throw Error(`Cannot string encode V0 in ${n.name} encoding`);let i=r.get(o);if(null!=i)return i;{let a=n.encode(t).slice(1);return r.set(o,a),a}}(r,V(e),t??S.encoder):function e(t,r,n){let{prefix:o}=n,i=r.get(o);if(null!=i)return i;{let a=n.encode(t);return r.set(o,a),a}}(r,V(e),t??x.encoder)}var T=new WeakMap;function V(e){let t=T.get(e);if(null==t){let r=new Map;return T.set(e,r),r}return t}var z=class e{code;version;multihash;bytes;"/";constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this["/"]=n}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:t,multihash:r}=this;if(t!==R)throw Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==j)throw Error("Cannot convert non sha2-256 multihash CID to CIDv0");return e.createV0(r)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:t,digest:r}=this.multihash,n=L(t,r);return e.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return e.equals(this,t)}static equals(e,t){let r=t;return null!=r&&e.code===r.code&&e.version===r.version&&B(e.multihash,r.multihash)}toString(e){return F(this,e)}toJSON(){return{"/":F(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(t){if(null==t)return null;let r=t;if(r instanceof e)return r;if(null!=r["/"]&&r["/"]===r.bytes||r.asCID===r){let{version:n,code:o,multihash:i,bytes:a}=r;return new e(n,o,i,a??H(n,o,i.bytes))}if(!0!==r[M])return null;{let{version:s,multihash:l,code:c}=r,f=E(l);return e.create(s,c,f)}}static create(t,r,n){if("number"!=typeof r)throw Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw Error("Invalid digest");switch(t){case 0:if(r!==R)throw Error(`Version 0 CID must use dag-pb (code: ${R}) block encoding`);return new e(t,r,n,n.bytes);case 1:{let o=H(t,r,n.bytes);return new e(t,r,n,o)}default:throw Error("Invalid version")}}static createV0(t){return e.create(0,R,t)}static createV1(t,r){return e.create(1,t,r)}static decode(t){let[r,n]=e.decodeFirst(t);if(0!==n.length)throw Error("Incorrect length");return r}static decodeFirst(t){let r=e.inspectBytes(t),n=r.size-r.multihashSize,o=u(t.subarray(n,n+r.multihashSize));if(o.byteLength!==r.multihashSize)throw Error("Incorrect length");let i=o.subarray(r.multihashSize-r.digestSize),a=new P(r.multihashCode,r.digestSize,i,o);return[0===r.version?e.createV0(a):e.createV1(r.codec,a),t.subarray(r.size)]}static inspectBytes(e){let t=0,r=()=>{let[r,n]=A(e.subarray(t));return t+=n,r},n=r(),o=R;if(18===n?(n=0,t=0):o=r(),0!==n&&1!==n)throw RangeError(`Invalid CID version ${n}`);let i=t,a=r(),s=r(),l=t+s;return{version:n,codec:o,multihashCode:a,digestSize:s,multihashSize:l-i,size:l}}static parse(t,r){let[n,o]=function e(t,r){switch(t[0]){case"Q":return[S.prefix,(r??S).decode(`${S.prefix}${t}`)];case S.prefix:return[S.prefix,(r??S).decode(t)];case x.prefix:return[x.prefix,(r??x).decode(t)];default:if(null==r)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[t[0],r.decode(t)]}}(t,r),i=e.decode(o);if(0===i.version&&"Q"!==t[0])throw Error("Version 0 CID string must not include multibase prefix");return V(i).set(n,t),i}},R=112,j=18;function H(e,t,r){let n=D(e),o=n+D(t),i=new Uint8Array(o+r.byteLength);return W(e,i,0),W(t,i,n),i.set(r,o),i}var M=Symbol.for("@ipld/js-cid/CID"),N={};function O({name:e,code:t,encode:r}){return new J(e,t,r)}o(N,{Hasher:()=>J,from:()=>O});var q,J=class{name;code;encode;constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?L(this.code,t):t.then(e=>L(this.code,e))}throw Error("Unknown type, must be binary type")}};return q=i,((o,i,a,s)=>{if(i&&"object"==typeof i||"function"==typeof i)for(let l of r(i))n.call(o,l)||void 0===l||e(o,l,{get:()=>i[l],enumerable:!(s=t(i,l))||s.enumerable});return o})(e({},"__esModule",{value:!0}),q)})()});let serviceWorkerRegistered=!1;async function isServiceWorkerRegistered(){let e=await navigator.serviceWorker.getRegistrations();return e.length>0}async function unregisterServiceWorkers(){let e=await navigator.serviceWorker.getRegistrations();for(let t of e)console.log("Unregistering Service Worker:",t),await t.unregister()}async function registerServiceWorker(e){if(await isServiceWorkerRegistered()){console.log("Service Worker is already registered.");return}try{let t=await navigator.serviceWorker.register("/service-worker.js");console.log("Service Worker registered successfully:",t)}catch(r){console.error("Service Worker registration failed:",r)}let n=window.location.href,o;if(n.includes("ipfs.localhost"))o="service-worker.js";else if(n.includes("/ipfs/")){let i=extractCID(n);if(i){let a=n.split("/ipfs/")[0]+"/ipfs/";o=`${a}${i}/service-worker.js`,console.log(o)}else{console.error("Could not extract CID from the URL.");return}}else o="./service-worker.js";if("serviceWorker"in navigator)try{let s=await navigator.serviceWorker.register(o);return console.log("Service Worker registered:",s),serviceWorkerRegistered=!0,await waitForServiceWorkerActivation(),s}catch(l){console.error("Service Worker registration failed:",l)}else console.error("Service Workers are not supported in this browser.")}function extractCID(e){let t=/ipfs\/([^\/\?\#\.\:\;\&]*)/i,r=/https?:\/\/([^\/\?\#\.\:\;\&]*)/i,n="";return t.test(e)?n=e.match(t)[1]:r.test(e)&&(n=e.match(r)[1]),n}let controllerChangeListenerAdded=!1;async function waitForServiceWorkerActivation(){if(navigator.serviceWorker.controller){console.log("Service Worker is already controlling the page.");return}return console.log("Waiting for Service Worker to activate..."),new Promise(e=>{controllerChangeListenerAdded?e():(navigator.serviceWorker.addEventListener("controllerchange",function t(){console.log("Service Worker is now controlling the page."),navigator.serviceWorker.removeEventListener("controllerchange",t),e()}),controllerChangeListenerAdded=!0)})}window.magicWasmInit=async function(e){let t={tarCID:"",jsScriptsArray:[],cssArray:[],rootSelector:"app",...e};showLoader(),await registerServiceWorker(),console.log("Service Worker is active. Setting up the virtual file system...");var r=await checkVirtualFileSystem();if(console.log(r),!0===r){let n=getIpfsUrls(t.tarCID),o=null;for(let i of n)try{let a=await loadBase64Script(i);if(o=await processByteArray(a),null!==o){console.log("tar file found");break}throw Error(`Failed to fetch tar file from URL: ${i}`)}catch(s){console.error(`Error fetching from URL ${i}:`,s)}if(!o){console.error("Failed to fetch tar file from all provided URLs.");return}await loadBrotliWasm();var l={};for(let c of o)!0==hasBrotliExtension(c.name)?(l[removeBrotliExtension(c.name)]=await decompressBrotliBuffer(c.buffer),console.log(`Decompressed: ${c.name}...`)):l[c.name]=c.buffer,console.log(`Added ${c.name} to virtual file system`);await setVirtualFileSystemInServiceWorker(l)}console.log("Virtual file system set in Service Worker."),await loadResources(t.jsScriptsArray,t.cssArray),hideLoader()};let isListenerAdded=!1;async function checkVirtualFileSystem(){return new Promise(async(e,t)=>{if(navigator.serviceWorker.controller){if(!isListenerAdded){function r(t){"VIRTUAL_FS_STATUS"===t.data.type&&(console.log("Virtual file system status:",t.data.isEmpty?"Empty":"Not empty"),e(t.data.isEmpty),navigator.serviceWorker.removeEventListener("message",r))}navigator.serviceWorker.addEventListener("message",r),isListenerAdded=!0}navigator.serviceWorker.controller.postMessage({type:"CHECK_VIRTUAL_FS"})}else{console.error("No Service Worker controller found.");try{clearData(),setTimeout(()=>{window.location.reload(!0)},5e3)}catch(n){console.error("Error during cleanup:",n),t("Cleanup failed")}}})}function clearData(){console.log("Starting full data wipe."),"serviceWorker"in navigator?navigator.serviceWorker.getRegistrations().then(function(e){let t=e.map(function(e){return console.log("Unregistering Service Worker:",e),e.unregister()});Promise.all(t).then(()=>{console.log("All Service Workers unregistered."),clearAllData()}).catch(e=>{console.error("Error during Service Worker unregistration:",e)})}):clearAllData()}function clearAllData(){"caches"in window&&caches.keys().then(function(e){e.forEach(function(e){console.log("Cache Deleted:",e),caches.delete(e)})});for(var e=document.cookie.split(";"),t=0;t<e.length;t++){console.log("Deleting Cookie");var r=e[t],n=r.indexOf("="),o=n>-1?r.substr(0,n):r;document.cookie=o+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/"}console.log("Local storage cleared"),localStorage.clear(),console.log("Session storage cleared"),sessionStorage.clear(),window.indexedDB&&(indexedDB.databases?indexedDB.databases():Promise.resolve([])).then(e=>{e.forEach(e=>{console.log("Deleting IndexedDB:",e.name),indexedDB.deleteDatabase(e.name)})})}function clearData(){console.log("Starting full data wipe."),"caches"in window&&caches.keys().then(function(e){e.forEach(function(e){console.log("Cache Deleted: "+e.toString()),caches.delete(e)})});for(var e=document.cookie.split(";"),t=0;t<e.length;t++){console.log("Deleting Cookie");var r=e[t],n=r.indexOf("="),o=n>-1?r.substr(0,n):r;document.cookie=o+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/"}console.log("Local storage cleared"),localStorage.clear(),console.log("Session storage cleared"),sessionStorage.clear()}function onMessage(e){"VIRTUAL_FS_STATUS"===e.data.type&&checkVirtualFileSystemResolve&&(checkVirtualFileSystemResolve(e.data.isEmpty),console.log("HERE"),checkVirtualFileSystemResolve=null)}function showLoader(){var e=extractCID(window.location.href),t=0;!window.location.href.includes("/ipfs/")&&(e=encodeURIComponent(window.location.href),t=1);var r=`https://ipfs.io/ipfs/QmV2tuTPpgYug1wdqg1KhSkPMe67Bnm7gA9ngbUbAWtcgh?redirectURL=${e}&autoadapt=1&requiresorigin=0&web3domain=${t}`;let n=document.createElement("div");n.id="fullPageLoader",n.style.position="fixed",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n.style.backgroundColor="white",n.style.zIndex="9999",n.style.display="flex",n.style.justifyContent="center",n.style.alignItems="center",n.style.flexDirection="column";let o=document.createElement("div");o.style.border="16px solid #f3f3f3",o.style.borderTop="16px solid #3498db",o.style.borderRadius="50%",o.style.width="150px",o.style.height="150px",o.style.animation="spin 2s linear infinite";let i=document.createElement("div");i.textContent="Loading...",i.style.fontSize="36px",i.style.fontFamily="Arial, sans-serif",i.style.color="#3498db",i.style.marginTop="20px";let a=document.createElement("div");a.textContent="Taking a long time to load?",a.style.fontSize="15px",a.style.fontFamily="Arial, sans-serif",a.style.color="black",a.style.marginTop="10px";let s=document.createElement("a");s.href=r,s.textContent="Click Here To Load Faster!",s.style.fontSize="15px",s.style.fontFamily="Arial, sans-serif",s.style.color="#3498db",s.style.marginTop="5px",s.style.textDecoration="underline",s.style.cursor="pointer",n.appendChild(o),n.appendChild(i),n.appendChild(a),n.appendChild(s),document.body.appendChild(n);let l=document.createElement("style");l.type="text/css",l.innerText=`
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    `,document.head.appendChild(l)}function hideLoader(){let e=document.getElementById("fullPageLoader");e&&e.remove()}function hasBrotliExtension(e){if("string"!=typeof e||!e)return!1;let t=e.trim();return t.toLowerCase().endsWith(".br")}function removeBrotliExtension(e){return hasBrotliExtension(e)?e.slice(0,-3):e}async function setVirtualFileSystemInServiceWorker(e){if(navigator.serviceWorker.controller)return await loadBrotliWasm(),new Promise(t=>{navigator.serviceWorker.controller.postMessage({type:"SET_VIRTUAL_FS",virtualFileSystem:e}),navigator.serviceWorker.addEventListener("message",function e(r){"VIRTUAL_FS_SET"===r.data.type&&(console.log("Received confirmation that virtual file system is set."),navigator.serviceWorker.removeEventListener("message",e),t())})});console.error("No Service Worker controller found to set virtual file system.")}async function loadResources(e,t){let r=window.location.href.endsWith("/")?window.location.href:`${window.location.href}/`;for(let n of t){console.log(`Loading CSS: ${n}`);let o=n.startsWith("virtual://")?n.replace("virtual://","./"):n;try{let i=await fetch(o);if(!i.ok){console.error(`Failed to load CSS: ${n}`);continue}let a=document.createElement("link");a.rel="stylesheet",a.href=n.startsWith("virtual://")?`${r}${o}`:n,document.head.appendChild(a),console.log(`Finished loading CSS: ${n}`)}catch(s){console.error(`Error loading CSS ${n}:`,s)}}for(let l of e){console.log(`Loading JS: ${l}`);let c=l.startsWith("virtual://")?l.replace("virtual://","./"):l;try{let f=await fetch(c);if(!f.ok){console.error(`Failed to load JS: ${l}`);continue}let u=await f.text(),d=document.createElement("script");d.textContent=u,document.body.appendChild(d),console.log(`Finished loading JS: ${l}`)}catch(h){console.error(`Error loading JS ${l}:`,h)}}console.log("All resources loaded.")}function cleanupComponents(e="app"){console.log(`Starting cleanup for components with selector: ${e}`);try{let t=document.querySelector(`#${e}`);if(t){console.log("Root element found:",t);try{"function"==typeof window.$destroy&&(console.log("Vue.js detected. Performing cleanup..."),window.$destroy(),console.log("Vue.js cleanup completed."))}catch(r){console.error("Error during Vue.js cleanup:",r)}try{"function"==typeof window.ngDestroy&&(console.log("Angular detected. Performing cleanup..."),window.ngDestroy(),console.log("Angular cleanup completed."))}catch(n){console.error("Error during Angular cleanup:",n)}try{"object"==typeof window.ReactDOM&&"function"==typeof window.ReactDOM.unmountComponentAtNode&&(console.log("React detected. Performing cleanup..."),window.ReactDOM.unmountComponentAtNode(t),console.log("React cleanup completed."))}catch(o){console.error("Error during React cleanup:",o)}try{"object"==typeof window.Blazor&&"function"==typeof window.Blazor.dispose&&(console.log("Blazor detected. Performing cleanup..."),window.Blazor.dispose(),console.log("Blazor cleanup completed."))}catch(i){console.error("Error during Blazor cleanup:",i)}try{console.log("Performing fallback cleanup..."),t.innerHTML="",console.log("Fallback cleanup completed.")}catch(a){console.error("Error during fallback cleanup:",a)}}else console.warn("Root element not found with selector:",e)}catch(s){console.error("An error occurred during component cleanup:",s)}console.log("Component cleanup process finished.")}const scriptId="temporary_base_64_file_text";function loadBase64Script(e){return new Promise((t,r)=>{let n="base64Script",o=document.getElementById(n);o&&(console.log("Existing Base64 script found. Cleaning up..."),o.remove()),console.log("Attempting to fetch the Base64 encoded file from: ",e);let i=setTimeout(()=>{r(Error("Fetch request timed out"))},15e3);fetch(e).then(e=>{if(clearTimeout(i),!e.ok)throw Error(`Network response was not ok: ${e.statusText}`);return e.text()}).then(e=>{console.log("Base64 content successfully retrieved:",e.slice(0,50)+"...");let r=atob(e),o=r.length,i=new Uint8Array(o);console.log("Decoding the Base64 content into a Uint8Array...");for(let a=0;a<o;a++)i[a]=r.charCodeAt(a);console.log("Decoded Uint8Array:",i),t(i);let s=document.getElementById(n);s&&(console.log("Cleaning up the script element after processing..."),s.remove())}).catch(e=>{clearTimeout(i),console.error("Failed to fetch or process the Base64 file:",e),r(e)})})}var brotliInstance=null;async function loadBrotliWasm(){return null===brotliInstance?(console.log("Brolti importing"),brotliInstance=await import("https://unpkg.com/brotli-wasm@3.0.1/index.web.js?module").then(e=>e.default)):(console.log("Brolti referencing import"),brotliInstance)}async function decompressBrotliBuffer(e){let t=e instanceof Uint8Array?e:new Uint8Array(e);try{let r=await decompressBrotli(t);return r}catch(n){throw console.error("Failed to decompress the buffer:",n),n}}async function decompressBrotli(e){let t=await loadBrotliWasm();return new Promise((r,n)=>{try{let o=t.decompress(e);r(o)}catch(i){n(i)}})}async function processByteArray(e){console.log("Processing the byteArray..."),console.log("First 10 bytes of the file:",e.slice(0,10));try{let t=await decompressBrotli(e);console.log("Decompressed Data:",t);let r=t.buffer,n=await untar(r);return n}catch(o){console.error("Error during processing:",o)}return null}function convertV0ToV1(e){try{var t=window.Multiformats.CID.parse(e);if(console.log("CID parsed:"),console.log(t),1===t.version)return console.log("CID is already v1"),t.toString();var r=t.toV1();return console.log("Converted to CIDv1:"),console.log(r),r.toString()}catch(n){throw console.error("Error converting CID:",n),Error("Invalid CIDv0")}}function getIpfsUrls(e){var t=window.location.href.toLowerCase(),r=[];if(e.startsWith("./")||e.startsWith("/")||e.startsWith("http://")||e.startsWith("https://"))return r=r.concat(e),console.log("Using local script"),r;for(let n of r=t.includes("ipfs.localhost")?(r=r.concat(getLocalIpfsUrls(t,e))).concat(getPublicGatewayUrls(e)):(r=r.concat(getPublicGatewayUrls(e))).concat(getLocalIpfsUrls(t,e)))console.log(`CID URLs: ${n}`);return r.filter(e=>void 0!==e)}function getPublicGatewayUrls(e){var t=[];return t.push(`https://ipfs.io/ipfs/${e}`),t.push(`https://dweb.link/ipfs/${e}`),t.push(`https://w3s.link/ipfs/${e}`),t}function getLocalIpfsUrls(e,t){var r=[],n=window.location.href.toLowerCase();if(n.includes("ipfs.localhost")){for(var o=n.indexOf(".ipfs.localhost"),i=n.indexOf(":",o)+1;i<n.length&&!isNaN(parseInt(n[i],10));)i++;var a=n.substring(o,i),s=convertV0ToV1(t);r.push(`http://${s}${a}`)}return r.push(`https://webui.ipfs.io/ipfs/${t}`),r}
